<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ‰‹æ©Ÿç§Ÿå€Ÿé ç´„</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <style>
    :root{ --gap:16px; --gap-lg:24px; --border:#dcdcdc; --text:#111; --muted:#666; --bg:#f7f7f7; --btn:#000; --btn2:#222; }
    *{box-sizing:border-box}
    body{ font-family:"Helvetica Neue", Arial, "PingFang TC","Noto Sans TC", system-ui, sans-serif;
      color:var(--text); background:var(--bg); margin:0;
      padding:clamp(16px,4vw,32px); max-width:780px; margin-inline:auto; }
    h1{font-size:clamp(22px,4vw,28px); text-align:center; margin:0 0 var(--gap-lg)}
    .form-row{margin-bottom:var(--gap-lg)}
    .label{display:block; font-weight:700; margin-bottom:8px}
    .muted{color:var(--muted); font-size:14px}

    .control{
      width:100%; display:block; padding:12px; font-size:16px; line-height:1.2;
      border:1px solid var(--border); border-radius:8px; background:#fff; outline:none;
      min-height:48px;
    }
    select.control{
      height:48px; -webkit-appearance:none; appearance:none; padding-right:42px;
      background-image:
        url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
      background-repeat:no-repeat; background-position:right 12px center; background-size:16px 16px;
    }
    .control:focus{border-color:#999; box-shadow:0 0 0 3px rgba(0,0,0,.06)}
    textarea.control{min-height:110px; resize:vertical}

    .checkbox{display:flex; align-items:flex-start; gap:10px}
    .checkbox input{width:20px; height:20px; margin-top:3px; accent-color:#111}
    .row-flex{display:flex; gap:8px; align-items:center}

    .summary{
      display:none; background:#eef3ff; border:1px solid #dbe3ff; color:#173b8e;
      border-radius:8px; padding:12px; margin-top:-6px; margin-bottom:var(--gap-lg); line-height:1.6; font-size:16px;
    }
    .summary b{font-weight:700}
    .req{ color:#d93025; font-weight:700; }
    .red{ color:#d93025; font-weight:700; }

    a.link{ color:#1a73e8; text-decoration:underline; }
    a.link:hover{ color:#0b5ed7; }
    a.link:visited, a.link.clicked{ color:#551A8B; }

    .actions{margin-top:28px}
    button{
      width:100%; padding:14px 18px; font-size:16px; border:none; border-radius:10px;
      color:#fff; background:var(--btn); cursor:pointer;
    }
    button:hover{background:var(--btn2)}
    button[disabled]{opacity:.6; cursor:not-allowed}

    /* Guide Modal */
    .modal{ display:none; position:fixed; inset:0; z-index:1000; background:rgba(0,0,0,.5); align-items:center; justify-content:center; }
    .modal-content{ background:#fff; width:min(760px,92vw); max-height:82vh; display:flex; flex-direction:column; border-radius:12px; padding:20px; }
    .guide-body{ line-height:1.7; font-size:15px; overflow:auto; max-height:calc(82vh - 64px); }
    .guide-body h3{ margin:14px 0 8px; font-size:16px }
    .guide-body ul{ padding-left:20px }
    .guide-footer{ margin-top:12px; }
    .close-bottom{ margin-top:12px; width:100%; }

    .note { margin-top:6px; font-size:14px; color:#444; }
  </style>
</head>
<body>
  <h1>æ‰‹æ©Ÿç§Ÿå€Ÿé ç´„</h1>

  <form id="rental-form" novalidate autocomplete="off">
    <div class="form-row">
      <label class="label" for="name">å§“åï¼ˆå¿…å¡«ï¼‰</label>
      <input class="control" type="text" id="name" name="name" required autocomplete="off"/>
    </div>

    <div class="form-row">
      <label class="label" for="phone">è¯çµ¡é›»è©±ï¼ˆå¿…å¡«ï¼‰</label>
      <!-- åƒ…å…è¨± 11 ä½æ•¸å­—ï¼›è¶…éè‡ªå‹•æˆªæ–· -->
      <input
        class="control"
        type="tel"
        id="phone"
        name="phone"
        inputmode="numeric"
        pattern="\\d{11}"
        maxlength="11"
        placeholder="è«‹è¼¸å…¥æœ‰æ•ˆé›»è©±è™Ÿç¢¼"
        required
        autocomplete="off"
      />
    </div>

    <!-- é›»å­ä¿¡ç®±ï¼ˆå¿…å¡«ï¼‰ + å‹•æ…‹ç¶²åŸŸä¸‹æ‹‰ -->
    <div class="form-row">
      <label class="label" for="email">é›»å­ä¿¡ç®±ï¼ˆå¿…å¡«ï¼‰</label>
      <input
        class="control"
        type="email"
        id="email"
        name="email"
        placeholder="yourname@example.com"
        list="emailHints"
        required
        autocomplete="off"
      />
      <datalist id="emailHints"></datalist>
      <div class="muted" style="margin-top:6px">è¼¸å…¥ã€Œ@ã€å¾Œæœƒå‡ºç¾å¸¸è¦‹ç¶²åŸŸå»ºè­°ï¼ˆå¯ç¹¼çºŒè¼¸å…¥ç¯©é¸ï¼‰ã€‚</div>
    </div>

    <div class="form-row">
      <label class="label" for="contactType">è¯çµ¡æ–¹å¼ï¼ˆå¿…å¡«ï¼‰</label>
      <div class="row-flex">
        <select id="contactType" name="contactType" class="control" style="flex:0.35" required>
          <option value="" disabled selected>é¸æ“‡æ–¹å¼</option>
          <option value="IG">IG</option>
          <option value="LINE">LINE</option>
        </select>
        <input type="text" id="contactId" name="contactId" class="control" style="flex:0.65"
               placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" required autocomplete="new-password"/>
      </div>
    </div>

    <!-- æ´»å‹•åç¨±ï¼ˆå¿…å¡«ï¼Œä½†ä¸å½±éŸ¿è©¦ç®—ï¼‰ -->
    <div class="form-row">
      <label class="label" for="event">æ´»å‹•åç¨±ï¼ˆå¿…å¡«ï¼‰</label>
      <input class="control" type="text" id="event" name="event" placeholder="è«‹å¡«å…¥æ¼”å”±æœƒæˆ–è—äººåç¨±ï¼Œä¾‹ï¼šBTSæ¼”å”±æœƒ" required autocomplete="off"/>
    </div>

    <!-- æ—¥æœŸå€é–“ -->
    <div class="form-row">
      <label class="label" for="daterange">ç§Ÿå€Ÿæ—¥æœŸå€é–“ï¼ˆå¿…å¡«ï¼‰</label>
      <input class="control" type="text" id="daterange" name="daterange" required placeholder="è«‹é¸æ“‡æ—¥æœŸå€é–“ï¼ˆæœ€å°‘ç§Ÿå€Ÿæ—¥ç‚º24å°æ™‚/1å¤©ï¼‰" autocomplete="off"/>
      <div class="muted" style="margin-top:6px">è¨ˆè²»ä»¥ 24 å°æ™‚ç‚º 1 å¤©ï¼Œè‡ªä¸‹æ–¹<strong>å–æ©Ÿæ™‚é–“</strong>èµ·ç®—ã€‚</div>
    </div>

    <!-- å–æ©Ÿåœ°é» -->
    <div class="form-row">
      <label class="label" for="pickup">é è¨ˆå–æ©Ÿåœ°é»ï¼ˆå¿…å¡«ï¼‰</label>
      <select class="control" id="pickup" name="pickup" required>
        <option value="" disabled selected>è«‹é¸æ“‡</option>
        <option>å¼˜å¤§ï¼ˆí™ëŒ€ï¼‰</option>
        <option>åˆäº•ï¼ˆí•©ì •ï¼‰</option>
        <option>ä¸Šæ°´ï¼ˆìƒìˆ˜ï¼‰</option>
        <option>ä¹è€æ•¸ç¢¼åœ’å€ï¼ˆêµ¬ë¡œë””ì§€í„¸ë‹¨ì§€ï¼‰</option>
        <option>å…¶ä»–ï¼ˆè«‹åœ¨å‚™è¨»å¡«å¯«ï¼‰</option>
      </select>
    </div>

    <!-- å–æ©Ÿæ™‚é–“ï¼ˆä¾åœ°é»æä¾›å›ºå®šæ™‚æ®µï¼‰ -->
    <div class="form-row">
      <label class="label" for="pickupTime">å–æ©Ÿæ™‚é–“ <span class="red">ï¼ˆèµ·ç®—æ™‚é–“ï¼Œå¿…å¡«ï¼‰</span></label>
      <select class="control" id="pickupTime" name="pickupTime" required disabled>
        <option value="" selected>è«‹å…ˆé¸æ“‡å–æ©Ÿåœ°é»</option>
      </select>
      <div id="pickupTimeNote" class="note"></div>
    </div>

    <!-- é‚„æ©Ÿæ™‚é–“ï¼ˆåŒæ¨£ç”¨ä¸‹æ‹‰é¸å–®ï¼‰ -->
    <div class="form-row">
      <label class="label" for="returnTime">é è¨ˆé‚„æ©Ÿæ™‚é–“ <span class="red">ï¼ˆå¯ä¸åŒæ–¼èµ·ç®—æ™‚é–“ï¼‰</span></label>
      <select class="control" id="returnTime" name="returnTime" required disabled>
        <option value="" selected>è«‹å…ˆé¸æ“‡å–æ©Ÿåœ°é»</option>
      </select>
      <div class="muted" style="margin-top:6px">è‹¥æ™šæ–¼èµ·ç®—æ™‚é–“ï¼Œç³»çµ±å°‡ä¾è¦å‰‡è‡ªå‹•ä¼°ç®—é€¾æ™‚è²»ï¼š2å°æ™‚å…§æŒ‰å°æ™‚ï¼Œ2å°æ™‚ä»¥ä¸Šç‚ºåŠå¤©ï¼Œ<b>è¶…é8å°æ™‚ç‚ºä¸€å¤©</b>ã€‚</div>
    </div>

    <!-- æ‘˜è¦ -->
    <div id="summary" class="summary" aria-live="polite">
      ğŸ“¦ é ˜å–ï¼š<b id="pickup-date"></b><br />
      ğŸ“¦ æ­¸é‚„ï¼š<b id="return-date"></b><br />
      â° ç§Ÿå€Ÿå¤©æ•¸ï¼ˆ24hç‚ºä¸€æ—¥ï¼‰ï¼š<b id="rental-days"></b>
    </div>

    <div class="form-row">
      <label class="label" for="model">ç§Ÿå€Ÿè¨­å‚™ï¼ˆå¿…å¡«ï¼‰</label>
      <select class="control" id="model" name="model" required>
        <option value="" disabled selected>è«‹é¸æ“‡</option>
        <option value="S23 Ultra é»‘ 256G">Samsung Galaxy S23 Ultra é»‘ 256Gï¼ˆå·²è²¼ä¿è­·è²¼ï¼‰</option>
      </select>
    </div>

    <div class="form-row">
      <label class="label">åŠ å€¼é…ä»¶</label>
      <label class="checkbox" for="charger">
        <input type="checkbox" id="charger" name="charger" />
        <span>éœ€è¦ Type-C å……é›»é ­ï¼ˆå…è²»å€Ÿç”¨ï¼Œè«‹å…ˆå‹¾é¸ç¢ºä¿æº–å‚™ï¼‰</span>
      </label>
      <label class="checkbox" for="usba">
        <input type="checkbox" id="usba" name="usba" />
        <span>éœ€è¦ Type-C â‡„ Type-C ç·šï¼ˆå¯æ›¿æ›ç‚º USB â‡„ Type-Cï¼Œå¦‚æœ‰éœ€è¦æ›´æ›è«‹åœ¨å‚™è¨»æ¬„å¡«å¯«ã€‚ï¼‰</span>
      </label>
    </div>

    <!-- ä»˜æ¬¾å¹£åˆ¥ -->
    <div class="form-row">
      <label class="label" for="currency">ä»˜æ¬¾å¹£åˆ¥ï¼ˆå¿…å¡«ï¼‰</label>
      <select class="control" id="currency" name="currency" required>
        <option value="" disabled selected>è«‹é¸æ“‡å¹£åˆ¥</option>
        <option value="TWD">å°å¹£</option>
        <option value="KRW">éŸ“å¹£</option>
      </select>
    </div>

    <!-- é‡‘é¡æ‘˜è¦ -->
    <div id="priceSummary" class="summary" aria-live="polite" style="display:none"></div>

    <div class="form-row">
      <label class="label" for="note">å‚™è¨»</label>
      <textarea class="control" id="note" name="note" placeholder="è‹¥éœ€ä¸åŒæ­¸é‚„æ—¥æœŸ/æ™‚é–“ã€ç‰¹æ®Šéœ€æ±‚ï¼ˆWater Bomb/é•·æ™‚æ‹æ”ï¼‰ã€æˆ–å…¶ä»–åœ°é»ï¼Œè«‹åœ¨æ­¤è£œå……ã€‚" autocomplete="off"></textarea>
    </div>

    <div class="form-row">
      <label class="checkbox" for="agree">
        <input type="checkbox" id="agree" name="agree" required disabled />
        <span>æˆ‘å·²é–±è®€ä¸¦åŒæ„ <a href="#guide" id="guideLink" class="link">ç§Ÿå€ŸæŒ‡å—</a>ï¼ˆå¿…å¡«ï¼‰</span>
      </label>
      <div class="muted">é€å‡ºä»£è¡¨åŒæ„ç§Ÿå€Ÿã€æŠ¼é‡‘ã€é€¾æ™‚èˆ‡è³ å„Ÿç›¸é—œè¦ç¯„ã€‚</div>
    </div>

    <div class="actions">
      <button id="submitBtn" type="submit">é€å‡ºé ç´„</button>
    </div>
  </form>

  <!-- ç§Ÿå€ŸæŒ‡å—å½ˆçª— -->
  <div id="guideModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="guideTitle">
    <div class="modal-content">
      <h2 id="guideTitle">S23Uæ‰‹æ©Ÿç§Ÿå€ŸæŒ‡å—</h2>
      <div id="guideScroll" class="guide-body">
        <h3>ã€ç§Ÿå€Ÿè¨­å‚™ã€‘</h3>
        <ul>
          <li>Samsung Galaxy S23 Ultra é»‘ 256Gï¼ˆå·²è²¼ä¿è­·è²¼ï¼‰</li>
          <li>é™„æ‰‹æ©Ÿæ®¼ã€Type-C å° Type-C å……é›»ç·šï¼ˆå¯äº‹å…ˆå‘ŠçŸ¥æ˜¯å¦éœ€è¦å……é›»é ­æˆ–æ˜¯å¦éœ€è¦æ›æˆ USB å° Type-C å……é›»ç·šï¼‰</li>
        </ul>

        <h3>ã€ç§Ÿå€Ÿè²»ç”¨ã€‘ï¼ˆå°å¹£ï¼‰</h3>
        <ul>
          <li>1â€“2å¤©ï¼šNT$700/æ—¥</li>
          <li>3â€“4å¤©ï¼šNT$650/æ—¥</li>
          <li>5å¤©(å«)ä»¥ä¸Šï¼šNT$600/æ—¥</li>
          <li>è¨‚é‡‘ï¼šNT$500</li>
        </ul>
        <p>ğŸ‘‰ <b>ä»¥ 24 å°æ™‚ç‚º 1 å¤©</b> è¨ˆç®—ï¼Œè‡ªé¢äº¤ç•¶å¤©æ™‚é–“èµ·ç®—ã€‚</p>
        <p>ä¾‹1ï¼š8/1 20:00 å–æ©Ÿ â†’ 8/2 20:00 æ­¸é‚„ = 1 å¤©<br>
           ä¾‹2ï¼š8/1 20:00 å–æ©Ÿ â†’ 8/5 20:00 æ­¸é‚„ = 4 å¤©</p>
        <p>â° è¶…æ™‚ï¼šæ¯å°æ™‚ NT$100ï¼Œä¸Šé™ NT$700/æ—¥ã€‚</p>
        <ul>
          <li>è¶…æ™‚ 2 å°æ™‚ä»¥å…§ â†’ æ¯å°æ™‚ NT$100ï¼ˆæˆ– KRâ‚©4,000ï¼‰ã€‚</li>
          <li>è¶…æ™‚ 2 å°æ™‚ä»¥ä¸Š â†’ ä»¥ã€ŒåŠå¤©ã€NT$350ï¼ˆæˆ– KRâ‚©16,000ï¼‰è¨ˆç®—ã€‚</li>
          <li><b>è¶…é 8 å°æ™‚ â†’ ä»¥ 1 å¤©è¨ˆç®—ã€‚</b></li>
        </ul>

        <h3>ã€ç§Ÿå€Ÿè²»ç”¨ã€‘ï¼ˆéŸ“å¹£ï¼‰</h3>
        <ul>
          <li>1â€“2å¤©ï¼šKRâ‚© 32,000/æ—¥</li>
          <li>3â€“4å¤©ï¼šKRâ‚© 30,000/æ—¥</li>
          <li>5å¤©(å«)ä»¥ä¸Šï¼šKRâ‚© 28,000/æ—¥</li>
          <li>è¨‚é‡‘ï¼šKRâ‚© 20,000</li>
        </ul>
        <p>ğŸ‘‰ğŸ‘‰ <b>ä»¥ 24 å°æ™‚ç‚º 1 å¤©</b> è¨ˆç®—ï¼Œè‡ªé¢äº¤ç•¶å¤©æ™‚é–“èµ·ç®—ã€‚</p>
        <p>ä¾‹1ï¼š8/1 20:00 å–æ©Ÿ â†’ 8/2 20:00 æ­¸é‚„ = 1 å¤©<br>
           ä¾‹2ï¼š8/1 20:00 å–æ©Ÿ â†’ 8/5 20:00 æ­¸é‚„ = 4 å¤©</p>
        <p>â° è¶…æ™‚ï¼šæ¯å°æ™‚ KRâ‚© 4,000ï¼Œä¸Šé™ KRâ‚© 32,000/æ—¥ã€‚</p>
        <ul>
          <li>è¶…æ™‚ 2 å°æ™‚ä»¥å…§ â†’ æ¯å°æ™‚ KRâ‚©4,000ã€‚</li>
          <li>è¶…æ™‚ 2 å°æ™‚ä»¥ä¸Š â†’ ä»¥ã€ŒåŠå¤©ã€ KRâ‚©16,000 è¨ˆç®—ã€‚</li>
          <li><b>è¶…é 8 å°æ™‚ â†’ ä»¥ 1 å¤©è¨ˆç®—ã€‚</b></li>
        </ul>

        <h3>ã€é¢äº¤åœ°é»èˆ‡æ™‚æ®µã€‘</h3>
        <ul>
          <li>å¼˜å¤§ï¼ˆí™ëŒ€ï¼‰â†’ å¯é ˜å–ï¼æ­¸é‚„æ™‚é–“ï¼šæ™šä¸Š 8:00 â€“ æ™šä¸Š 11:30</li>
          <li>åˆäº•ï¼ˆí•©ì •ï¼‰â†’ å¯é ˜å–ï¼æ­¸é‚„æ™‚é–“ï¼šæ™šä¸Š 8:00 â€“ æ™šä¸Š 11:30</li>
          <li>ä¸Šæ°´ï¼ˆìƒìˆ˜ï¼‰â†’ å¯é ˜å–ï¼æ­¸é‚„æ™‚é–“ï¼šæ™šä¸Š 8:00 â€“ æ™šä¸Š 11:30</li>
          <li>ä¹è€æ•¸ç¢¼åœ’å€ï¼ˆêµ¬ë¡œë””ì§€í„¸ë‹¨ì§€ï¼‰â†’ å¯é ˜å–ï¼æ­¸é‚„æ™‚é–“ï¼šæ—©ä¸Š 11:00 â€“ æ™šä¸Š 7:00</li>
          <li>å…¶ä»–åœ°é» â†’ é ˆå…ˆèˆ‡å‡ºç§Ÿæ–¹å”èª¿ï¼ˆç³»çµ±å°‡ä»¥ 20:00 æš«å®šè©¦ç®—ï¼‰ã€‚</li>
        </ul>
        
        <h3>ã€æŠ¼é‡‘åŠè­‰ä»¶ã€‘</h3>
        <ul>
          <li>æŠ¼é‡‘ NT$3000ï¼ˆæˆ– KRW 120,000ï¼‰</li>
          <li>æœ¬äººæœ‰æ•ˆè­‰ä»¶æ­£æœ¬ï¼ˆèº«åˆ†è­‰ã€å¥ä¿å¡ã€é§•ç…§ æ“‡ä¸€ï¼‰</li>
        </ul>
        <ul>
          <li>âš ï¸ ç„¡è­‰ä»¶æŠµæŠ¼è€…ï¼Œéœ€ç¹³æ›´é«˜é¡æŠ¼é‡‘ NT$25,000ï¼ˆæˆ– KRW 1,000,000ï¼‰ã€‚</li>
          <li>âš ï¸ æŠ¼é‡‘èˆ‡è­‰ä»¶æœƒåœ¨æ­¸é‚„ã€æª¢æŸ¥å®Œç•¢å¾Œä¸€ä½µé€€é‚„ã€‚</li>
        </ul>

        <h3>ã€é ç´„æµç¨‹ã€‘</h3>
        <ol>
          <li>ç¢ºèªæ¬²ç§Ÿå€Ÿæ—¥æœŸï¼ˆå¯æå‰ 1â€“2 å€‹æœˆé ç´„ï¼‰</li>
          <li>å¡«å¯«åŸºæœ¬è³‡è¨Šï¼šå§“åï¼é›»è©±ï¼è¯çµ¡æ–¹å¼ï¼ˆIG/ LINEï¼‰ï¼æ¬²ç§Ÿå€Ÿæ—¥æœŸï¼æ´»å‹•åç¨±ï¼é¢äº¤åœ°é»</li>
          <li>æ”¯ä»˜è¨‚é‡‘ NT$500ï¼ˆä¿ç•™æ‰‹æ©Ÿï¼Œå–æ¶ˆä¸é€€é‚„ï¼‰</li>
          <li>é¢äº¤æ™‚æ”¯ä»˜å°¾æ¬¾ï¼‹æŠ¼é‡‘ï¼‹æœ¬äººæœ‰æ•ˆè­‰ä»¶æ­£æœ¬</li>
          <li>ç§Ÿå€ŸçµæŸï¼Œæª¢æŸ¥æ‰‹æ©Ÿç‹€æ…‹ â†’ æ­¸é‚„æŠ¼é‡‘èˆ‡è­‰ä»¶</li>
        </ol>

        <h3>ã€ç§Ÿå€Ÿæ³¨æ„äº‹é …ã€‘</h3>
        <ol>
          <li><b>æ‰¿ç§Ÿè³‡æ ¼</b>ï¼šæ‰¿ç§Ÿäººéœ€å¹´æ»¿ 18 æ­²ï¼Œä¸¦ä»¥æœ¬äººåç¾©ç§Ÿå€Ÿèˆ‡ä½¿ç”¨ï¼Œä¸å¾—è½‰å€Ÿã€åˆ†ç§Ÿæˆ–ä¾›ç¬¬ä¸‰äººä½¿ç”¨ã€‚</li>
          <li><b>è³‡æ–™æ¸…é™¤èˆ‡å‚™ä»½</b>ï¼šæ‰¿ç§Ÿäººé ˆè‡ªè¡Œè² è²¬ç§Ÿå€ŸæœŸé–“æ–¼è¨­å‚™ä¸Šæ‰€ç”¢ç”Ÿæˆ–å„²å­˜çš„å€‹äººè³‡æ–™ï¼Œä¸¦æ–¼æ­¸é‚„å‰å®Œæˆå‚™ä»½èˆ‡åˆªé™¤ï¼›è‹¥å› æœªæ¸…é™¤æˆ–å‚™ä»½ä¸è¶³è€Œå°è‡´è³‡æ–™å¤–æ´©æˆ–éºå¤±ï¼Œå‡ºç§Ÿæ–¹ä¸æ‰¿æ“”ä»»ä½•è²¬ä»»ã€‚</li>
          <li><b>å€‹è³‡å®‰å…¨æé†’</b>ï¼šæ‰¿ç§Ÿæ™‚åƒ…éœ€æä¾›æœ¬äººæœ‰æ•ˆè­‰ä»¶æ­£æœ¬ï¼Œåƒ…ä½œç‚ºç§Ÿå€ŸæœŸé–“çš„æŠµæŠ¼ä¿éšœç”¨ï¼Œå‡ºç§Ÿæ–¹ä¸æœƒå¦è¡Œè¤‡è£½æˆ–ç•™å­˜ï¼›æ‰‹æ©Ÿæ­¸é‚„æª¢æŸ¥å®Œæˆå¾Œï¼Œæœƒèˆ‡æŠ¼é‡‘ä¸€ä½µè¿”é‚„ã€‚æ‰¿ç§Ÿäººæ‡‰è‡ªè¡Œæ³¨æ„å¸³è™Ÿå®‰å…¨ï¼Œä¸¦æ–¼æ­¸é‚„å‰åˆªé™¤å€‹äººè³‡æ–™ã€‚</li>
          <li><b>è¨­å‚™æª¢æŸ¥</b>ï¼šé¢äº¤æ™‚é›™æ–¹éœ€ç¢ºèªæ‰‹æ©Ÿå¤–è§€ã€åŠŸèƒ½ï¼Œä¸¦å¯éŒ„å½±æˆ–æ‹ç…§å­˜è­‰ã€‚</li>
          <li><b>ä½¿ç”¨é™åˆ¶</b>ï¼šä¸å¾—éš¨æ„ä¸‹è¼‰éå¿…è¦æˆ–å±éšª Appï¼›è‹¥é€ æˆä¸­æ¯’æˆ–æ•…éšœï¼Œæ‰¿ç§Ÿäººéœ€è² ç¶­ä¿®è²»ã€‚</li>
          <li><b>è³ å„Ÿè¦ç¯„</b>ï¼šæ‰‹æ©Ÿè‹¥éºå¤±ã€æå£ã€åˆ®å‚·æˆ–é€²æ°´ï¼Œéœ€ä¾ Samsung åŸå» ç¶­ä¿®ï¼æ›æ–°å ±åƒ¹è³ å„Ÿï¼ˆå«é…ä»¶ï¼‰ã€‚å‡ºç§Ÿæ–¹å¯å…ˆè¡Œæ‰£æŠµæŠ¼é‡‘ï¼Œè‹¥ä¸è¶³éœ€ç”±æ‰¿ç§Ÿäººè£œè¶³ã€‚</li>
          <li><b>é›»é‡æª¢æŸ¥é…åˆ</b>ï¼šæ­¸é‚„æ™‚è«‹ç›¡é‡ä¿ç•™é›»é‡ï¼ˆ20â€“30%ï¼‰ï¼Œæ–¹ä¾¿ç«‹å³å®Œæˆæª¢æŸ¥ï¼›è‹¥é›»é‡ä¸è¶³å°è‡´ç„¡æ³•ç•¶å ´æª¢æ¸¬ï¼Œå¯èƒ½éœ€å»¶å¾Œé€€é‚„æŠ¼é‡‘ã€‚</li>
          <li><b>è¶…æ™‚è™•ç†</b>ï¼šè¶…æ™‚ 2 å°æ™‚ä»¥å…§ï¼Œæ¯å°æ™‚æ”¶è²» NT$100ï¼ˆKRâ‚©4,000ï¼‰ï¼›è¶…é 2 å°æ™‚ä»¥åŠå¤©è¨ˆç®— NT$350ï¼ˆKRâ‚©16,000ï¼‰ï¼›<b>è¶…é 8 å°æ™‚ä»¥ 1 å¤©è¨ˆç®—</b>ã€‚è‹¥å› æ­¤å½±éŸ¿å¾ŒçºŒç§Ÿå€Ÿå®‰æ’ï¼Œé™¤è¨‚é‡‘ä¸äºˆé€€é‚„å¤–ï¼Œæ‰¿ç§Ÿäººä¸¦éœ€é¡å¤–è³ å„Ÿå‡ºç§Ÿäººå› è¶…æ™‚é€ æˆçš„ç§Ÿé‡‘æå¤±ã€‚</li>
          <li><b>ç§ŸæœŸè¦ç¯„</b>ï¼šç§Ÿå€Ÿä»¥ 24 å°æ™‚ç‚º 1 æ—¥è¨ˆç®—ï¼Œè¨‚é‡‘æ•ä¸é€€é‚„ã€‚ç§Ÿå€Ÿé–‹å§‹æ—¥ä¸€é€±å…§ï¼Œè‹¥æœ‰<b>å¤§å¹…æ›´å‹•ï¼ˆä¾‹å¦‚æ›´æ”¹ 2 å¤©ä»¥ä¸Šæˆ–æ•´æ®µæ™‚ç¨‹ï¼‰</b>ï¼Œå‡ºç§Ÿæ–¹å¾—è¦–æƒ…æ³è‡ªè¨‚é‡‘ä¸­æ‰£é™¤ NT$200ï¼ˆKRâ‚©8,000ï¼‰ä½œç‚ºå”èª¿èˆ‡æ’ç¨‹è¾›è‹¦è²»ï¼Œä¸”ä¸ä¿è­‰æ¬²æ›´æ”¹çš„æ—¥æœŸå€é–“ä¸€å®šèƒ½ç§Ÿå€Ÿï¼Œå°‡ä»¥é¦–æ¬¡é ç´„æ™‚æ®µç‚ºå„ªå…ˆã€‚</li>
          <li><b>æ•…éšœè™•ç†</b>ï¼šç§Ÿå€ŸæœŸé–“å¦‚ç™¼ç”Ÿç•°å¸¸æˆ–æ•…éšœï¼Œæ‰¿ç§Ÿäººæ‡‰ç«‹å³é€šçŸ¥å‡ºç§Ÿæ–¹ï¼›è‹¥ç¢ºèªç‚ºäººç‚ºå› ç´ ï¼Œå‰‡éœ€ä¾ç…§æ³¨æ„äº‹é …ç¬¬ 6 é»è³ å„Ÿã€‚</li>
          <li><b>è¦å‰‡ä¿®æ­£</b>ï¼šå‡ºç§Ÿæ–¹ä¿ç•™èª¿æ•´ç§Ÿå€Ÿè¦å‰‡èˆ‡åƒ¹æ ¼ä¹‹æ¬Šåˆ©ï¼Œè‹¥æœ‰è®Šæ›´å°‡æå‰å…¬å‘Šä¸¦é€šçŸ¥æ‰¿ç§Ÿäººã€‚</li>
          <li><b>ä½¿ç”¨æé†’</b>ï¼šè«‹å¦¥å–„ä¿ç®¡è¨­å‚™ï¼Œé¿å…ä¸ç•¶æ“ä½œæˆ–é«˜é¢¨éšªç’°å¢ƒä½¿ç”¨ï¼ŒåŒ…æ‹¬é•·æ™‚é–“æ›æ›¬ã€é«˜æº«ç’°å¢ƒæˆ–æ¶‰æ°´æƒ…æ³ã€‚è‹¥æœ‰ç‰¹æ®Šéœ€æ±‚ï¼ˆå¦‚ Water Bombã€æˆ¶å¤–é•·æ™‚é–“æ‹æ”ç­‰ï¼‰ï¼Œè«‹å‹™å¿…äº‹å…ˆå‘ŠçŸ¥å‡ºç§Ÿæ–¹ï¼Œä»¥åˆ©å”èª¿ä¸¦ä¿éšœé›™æ–¹æ¬Šç›Šã€‚</li>
        </ol>
      </div>
      <button class="close-bottom" id="closeGuideBtn" type="button">é—œé–‰</button>
      <div class="guide-footer muted">ï¼ˆå·²é–±è®€è‡³åº•éƒ¨å¾Œï¼Œå°‡è‡ªå‹•è§£é–ã€ŒåŒæ„ã€å‹¾é¸ï¼‰</div>
    </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const API_BASE = "https://script.google.com/macros/s/AKfycbw96IKgRxbRIXhsHbaYArxV2jKJYTEcJh2EDp23To3x9mh38yXU_zocA7rCP-X-cH8O/exec";
    const $ = (id)=>document.getElementById(id);
    const summary = $("summary"), pickupEl=$("pickup-date"), returnEl=$("return-date"), daysEl=$("rental-days"), priceSummary=$("priceSummary");

    function depositOf(c){ return c==='KRW'?120000:3000; }
    function sign(c){ return c==='KRW'?'â‚©':'$'; }
    function fmt(c,n){ return sign(c)+Number(n).toLocaleString(); }
    function unitPrice(c,d){ if(c==='TWD'){ if(d>=5)return 600; if(d<=2)return 700; return 650; } if(c==='KRW'){ if(d>=5)return 28000; if(d<=2)return 32000; return 30000;} return 0;}
    const Overage={TWD:{perHour:100,halfDay:350,perDay:700},KRW:{perHour:4000,halfDay:16000,perDay:32000}};

    (function(){ document.querySelectorAll('label,.label,h1,h2,h3,h4').forEach(el=>{ el.innerHTML=el.innerHTML.replace(/ï¼ˆå¿…å¡«ï¼‰/g,'<span class="req">ï¼ˆå¿…å¡«ï¼‰</span>'); }); })();

    function toYMDLocal(d){const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`;}
    function wd(d){return ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'][d.getDay()]}
    function daysBy24h(s,e,t){const[hh,mm]=t.split(':').map(Number);const S=new Date(s.getFullYear(),s.getMonth(),s.getDate(),hh,mm||0,0);const E=new Date(e.getFullYear(),e.getMonth(),e.getDate(),hh,mm||0,0);const ms=E-S;if(ms<=0)return{days:0,startDT:S,endDT:E};return{days:Math.ceil(ms/86400000),startDT:S,endDT:E};}
    function calcOverage(c,plannedEndDT,rtStr){ if(!rtStr) return{hours:0,fee:0,rule:'none'}; const[rh,rm]=rtStr.split(':').map(Number); const actual=new Date(plannedEndDT.getFullYear(),plannedEndDT.getMonth(),plannedEndDT.getDate(),rh,rm||0,0); const diff=actual-plannedEndDT; if(diff<=0) return{hours:0,fee:0,rule:'none'}; const h=Math.ceil(diff/3600000); const cfg=Overage[c]||Overage.TWD; if(h<=2) return{hours:h,fee:Math.min(h*cfg.perHour,cfg.perDay),rule:'hourly'}; if(h<=8) return{hours:h,fee:cfg.halfDay,rule:'half'}; return{hours:h,fee:cfg.perDay,rule:'day'}; }

    // å¯å–/é‚„æ©Ÿæ™‚æ®µ
    const TIME_WINDOWS = {
      "å¼˜å¤§ï¼ˆí™ëŒ€ï¼‰": { start: "20:00", end: "23:30" },
      "åˆäº•ï¼ˆí•©ì •ï¼‰": { start: "20:00", end: "23:30" },
      "ä¸Šæ°´ï¼ˆìƒìˆ˜ï¼‰": { start: "20:00", end: "23:30" },
      "ä¹è€æ•¸ç¢¼åœ’å€ï¼ˆêµ¬ë¡œë””ì§€í„¸ë‹¨ì§€ï¼‰": { start: "11:00", end: "19:00" }
    };
    const OTHER_PLACE_SLOT = "20:00"; // å…¶ä»–åœ°é»æš«å®šä¼°ç®—ç”¨

    function genSlots(start,end,stepMin=30){
      const [sh,sm]=start.split(':').map(Number), [eh,em]=end.split(':').map(Number);
      let cur = new Date(2000,0,1,sh,sm,0), last = new Date(2000,0,1,eh,em,0);
      const out=[];
      while(cur<=last){ const hh=String(cur.getHours()).padStart(2,'0'); const mm=String(cur.getMinutes()).padStart(2,'0'); out.push(`${hh}:${mm}`); cur.setMinutes(cur.getMinutes()+stepMin); }
      return out;
    }

    let disabledSet = new Set();
    let returnManuallyChanged = false;

    async function init(){
      // å·²é ç´„æ—¥
      let disabledRanges=[];
      try{
        const r=await fetch(API_BASE+"?action=reserved",{cache:"no-store"}); const ranges=await r.json();
        if(Array.isArray(ranges)){
          disabledRanges=ranges.map(x=>({from:x.start,to:x.end}));
          ranges.forEach(({start,end})=>{
            const s=new Date(start), e=new Date(end);
            const cur=new Date(s.getFullYear(),s.getMonth(),s.getDate());
            const last=new Date(e.getFullYear(),e.getMonth(),e.getDate());
            while(cur<=last){ disabledSet.add(toYMDLocal(cur)); cur.setDate(cur.getDate()+1); }
          });
        }
      }catch(err){ console.warn("å–å¾—é ç´„å€é–“å¤±æ•—ï¼š",err); }

      // æ—¥æœŸï¼ˆæœ€çŸ­24hï¼‰
      flatpickr("#daterange",{
        mode:"range", minDate:"today", allowInput:false, dateFormat:"Y-m-d to Y-m-d", disable:disabledRanges,
        onChange:(dates,_s,inst)=>{
          if(dates.length===1){ inst.input.value=""; hideSummaries(); return; }
          if(dates.length===2){
            const d0=new Date(dates[0].getFullYear(),dates[0].getMonth(),dates[0].getDate());
            const d1=new Date(dates[1].getFullYear(),dates[1].getMonth(),dates[1].getDate());
            if(d0.getTime()===d1.getTime()){ const next=new Date(d0); next.setDate(d0.getDate()+1); inst.setDate([d0,next],true); }
            else{ inst.input.value=`${inst.formatDate(dates[0],"Y-m-d")} to ${inst.formatDate(dates[1],"Y-m-d")}`; updateSummaries(); updatePrice(); }
          }
        }
      });

      // é›»è©±è¼¸å…¥ï¼šåƒ…æ•¸å­— + æœ€é•· 11 ä½
      $("phone").addEventListener("input", (e)=>{
        const v = e.target.value.replace(/\D+/g,"").slice(0,11);
        e.target.value = v;
      });

      // é›»å­ä¿¡ç®±æç¤º
      const commonDomains = ["gmail.com","yahoo.com","yahoo.com.tw","icloud.com","hotmail.com","outlook.com","hotmail.com.tw"];
      const emailInput = $("email");
      const emailHints = $("emailHints");
      emailInput.addEventListener("input", ()=>{
        const val = emailInput.value;
        emailHints.innerHTML = "";
        const atIdx = val.indexOf("@");
        if(atIdx === -1){
          // å°šæœªè¼¸å…¥ @ ï¼šçµ¦å¸¸è¦‹ç¶²åŸŸé è¦½
          commonDomains.forEach(dm=>{
            const opt = document.createElement("option");
            opt.value = `${val}@${dm}`.replace(/^@/,"user@"); // é¿å…ä½¿ç”¨è€…ä¸€é–‹å§‹å°±è¼¸å…¥@çš„é‚Šç•Œ
            emailHints.appendChild(opt);
          });
        }else{
          const local = val.slice(0, atIdx);
          const typedDom = val.slice(atIdx+1).toLowerCase();
          commonDomains
            .filter(dm=> dm.startsWith(typedDom))
            .forEach(dm=>{
              const opt = document.createElement("option");
              opt.value = `${local}@${dm}`;
              emailHints.appendChild(opt);
            });
        }
      });

      // åœ°é»â†’æ™‚æ®µ
      $("pickup").addEventListener("change", onPickupPlaceChange);

      $("pickupTime").addEventListener("change", ()=>{
        if(!returnManuallyChanged){ $("returnTime").value = $("pickupTime").value || OTHER_PLACE_SLOT; }
        updateSummaries(); updatePrice();
      });

      $("returnTime").addEventListener("change", ()=>{ returnManuallyChanged = true; updateSummaries(); updatePrice(); });

      ["model","currency","charger","usba","contactType","contactId","pickup","note","event"].forEach(id=>{
        const el=$(id); if(el) el.addEventListener('change', ()=>{ updatePrice(); });
      });

      document.getElementById("rental-form").addEventListener("submit", onSubmit);

      // æŒ‡å—å½ˆçª—
      const link=$("guideLink");
      link.addEventListener("click",(e)=>{ e.preventDefault(); link.classList.add("clicked"); openGuide(); });
      $("closeGuideBtn").addEventListener("click", ()=> closeGuide());
      $("guideModal").addEventListener("click", (e)=>{ if(e.target.id==="guideModal") closeGuide(); });
      $("guideScroll").addEventListener("scroll", onGuideScroll);

      updateSummaries(); updatePrice();
    }

    function fillSelectOptions(select, slots, placeholder){
      select.innerHTML = "";
      select.disabled = false;
      if(!slots || !slots.length){
        const opt=document.createElement("option");
        opt.value=""; opt.textContent=placeholder||"ç„¡å¯é¸æ™‚æ®µ";
        select.appendChild(opt);
        select.disabled = true;
        return;
      }
      slots.forEach(t=>{
        const opt=document.createElement("option");
        opt.value=t; opt.textContent=t;
        select.appendChild(opt);
      });
    }

    function onPickupPlaceChange(){
      const place = $("pickup").value;
      const pSel = $("pickupTime");
      const rSel = $("returnTime");
      const note = $("pickupTimeNote");
      pSel.innerHTML = ""; rSel.innerHTML = ""; pSel.disabled = rSel.disabled = false;

      const win = TIME_WINDOWS[place];
      if(!place){
        pSel.disabled = rSel.disabled = true;
        pSel.innerHTML = `<option value="" selected>è«‹å…ˆé¸æ“‡å–æ©Ÿåœ°é»</option>`;
        rSel.innerHTML = `<option value="" selected>è«‹å…ˆé¸æ“‡å–æ©Ÿåœ°é»</option>`;
        note.textContent = "";
        return;
      }

      if(!win){ // å…¶ä»–åœ°é»ï¼šä»¥ 20:00 æš«å®š
        const opt1=document.createElement("option");
        opt1.value=OTHER_PLACE_SLOT; opt1.textContent=`å”èª¿æ™‚é–“ï¼ˆæš«ä»¥ ${OTHER_PLACE_SLOT} è©¦ç®—ï¼‰`;
        pSel.appendChild(opt1); pSel.value=OTHER_PLACE_SLOT;

        const opt2=document.createElement("option");
        opt2.value=OTHER_PLACE_SLOT; opt2.textContent=`å”èª¿æ™‚é–“ï¼ˆæš«ä»¥ ${OTHER_PLACE_SLOT} è©¦ç®—ï¼‰`;
        rSel.appendChild(opt2); rSel.value=OTHER_PLACE_SLOT;

        note.textContent = `å…¶é¤˜åœ°é»é ˆå”èª¿ï¼Œç³»çµ±æš«ä»¥ ${OTHER_PLACE_SLOT} é€²è¡Œé‡‘é¡è©¦ç®—ï¼Œå¯¦éš›æ™‚é–“å¦è¡Œç¢ºèªã€‚`;
        returnManuallyChanged = false;
        updateSummaries(); updatePrice();
        return;
      }

      const slots = genSlots(win.start, win.end, 30);
      fillSelectOptions(pSel, slots, "ç„¡æ™‚æ®µ");
      fillSelectOptions(rSel, slots, "ç„¡æ™‚æ®µ");
      pSel.value = slots[0];
      if(!returnManuallyChanged){ rSel.value = pSel.value; }
      note.textContent = `å¯é ˜å–æ™‚é–“ï¼š${win.start}â€“${win.end}`;
      returnManuallyChanged = false;
      updateSummaries(); updatePrice();
    }

    function hideSummaries(){ $("summary").style.display="none"; priceSummary.style.display="none"; priceSummary.innerHTML=""; }
    function getSelectedDates(){ const fp=$("daterange")._flatpickr; const sel=fp?.selectedDates||[]; return sel.length===2?sel:null; }

    function updateSummaries(){
      const sel=getSelectedDates(); const t=$("pickupTime").value;
      if(!sel || !t){ hideSummaries(); return; }
      const [s,e]=sel; const r=daysBy24h(s,e,t); const d=r.days;
      $("summary").style.display="block";
      pickupEl.textContent = `${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()} ${t}ï¼ˆ${wd(s)}ï¼‰`;
      const rt = $("returnTime").value || t;
      returnEl.textContent = `${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()} ${rt}ï¼ˆ${wd(e)}ï¼‰`;
      daysEl.textContent = d>0 ? `${d}å¤©` : "â€”";
    }

    function updatePrice(){
      const model=$("model").value;
      const currency=$("currency").value;
      const sel=getSelectedDates();
      const t=$("pickupTime").value;
      const rtSel = $("returnTime").value;
      const place=$("pickup").value||"";

      if(!currency){ priceSummary.style.display='none'; priceSummary.innerHTML=''; return; }

      // åªæª¢æŸ¥æœƒå½±éŸ¿è©¦ç®—çš„æ¬„ä½
      const missing=[];
      if(!sel) missing.push('ç§Ÿå€Ÿæ—¥æœŸå€é–“');
      if(!place) missing.push('å–æ©Ÿåœ°é»');
      if(!t && place && !place.includes('å…¶ä»–')) missing.push('å–æ©Ÿæ™‚é–“');
      if(!rtSel && place && !place.includes('å…¶ä»–')) missing.push('é‚„æ©Ÿæ™‚é–“');
      if(!model) missing.push('ç§Ÿå€Ÿè¨­å‚™');

      if(missing.length){
        priceSummary.innerHTML = `
          ğŸ”” <b>è«‹å…ˆå®Œæˆä»¥ä¸‹é …ç›®ä»¥é¡¯ç¤ºè©¦ç®—ï¼š</b><br>
          â€¢ ${missing.join('ã€')}<br>
          <hr style="border:none;border-top:1px solid #dbe3ff; margin:10px 0;">
          <span class="muted">â€» é€¾æ™‚è¦å‰‡ï¼š2 å°æ™‚å…§æŒ‰å°æ™‚ã€2â€“8 å°æ™‚åŠå¤©ã€è¶…é 8 å°æ™‚ä¸€å¤©ã€‚</span>
        `;
        priceSummary.style.display='block';
        return;
      }

      const [s,e]=sel;
      const {days,endDT}=daysBy24h(s,e,t || OTHER_PLACE_SLOT);
      if(days<=0){ priceSummary.style.display='none'; return; }

      const per=unitPrice(currency,days);
      const rentTotal=per*days;
      const deposit=depositOf(currency);
      const grand=rentTotal+deposit;

      const rtStr= rtSel || (t || OTHER_PLACE_SLOT);
      const over=calcOverage(currency,endDT,rtStr);

      const ruleMap={ none:'ç„¡é€¾æ™‚', hourly:`2 å°æ™‚å…§ï¼ŒæŒ‰å°æ™‚è¨ˆï¼ˆ${currency==='KRW'?'â‚©4,000':'$100'}/å°æ™‚ï¼‰`, half:'è¶…é 2 å°æ™‚ï¼Œä»¥åŠå¤©è¨ˆ', day:'è¶…é 8 å°æ™‚ï¼Œä»¥ 1 å¤©è¨ˆ' };
      const trialHint = place.includes('å…¶ä»–') ? `ã€€<span class="muted">ï¼ˆå…¶ä»–åœ°é»æš«ä»¥ <b>${OTHER_PLACE_SLOT}</b> è©¦ç®—ï¼‰</span>` : '';

      priceSummary.innerHTML = `
        ğŸ’° ç§Ÿé‡‘ç¸½é¡ï¼š<b>${fmt(currency, rentTotal)}</b><br>
        ğŸ”’ æŠ¼é‡‘ï¼š<b>${fmt(currency, deposit)}</b><br>
        ğŸ“Š ç¸½é¡ï¼ˆç§Ÿé‡‘+æŠ¼é‡‘ï¼‰ï¼š<b>${fmt(currency, grand)}</b><br>
        ï¼ˆ${days}å¤© Ã— æ¯æ—¥ <b>${fmt(currency, per)}</b>ï¼Œä»¥ <b>${t || OTHER_PLACE_SLOT}</b> èµ·ç®— 24h/æ—¥ï¼‰${trialHint}<br>
        <hr style="border:none;border-top:1px solid #dbe3ff; margin:10px 0;">
        â° é ä¼°é€¾æ™‚è²»ï¼š<b>${fmt(currency, over.fee)}</b>ã€€<span class="muted">ï¼ˆ${ruleMap[over.rule]}ï¼›æ™š <b>${over.hours}</b> å°æ™‚ï¼‰</span><br>
        <span class="muted">â€» é€¾æ™‚è²»åƒ…ä¾›é ä¼°ï¼Œå¯¦éš›æ–¼æ­¸é‚„ç•¶æ—¥ä¾è¦å®šçµç®—ï¼Œä¸ä½µå…¥é ä»˜ç¸½é¡ã€‚</span><br>
        <span class="muted">â€» é€¾æ™‚è¦å‰‡ï¼š2 å°æ™‚å…§æŒ‰å°æ™‚ã€2â€“8 å°æ™‚åŠå¤©ã€è¶…é 8 å°æ™‚ä¸€å¤©ã€‚</span>
      `;
      priceSummary.style.display='block';
    }

    async function onSubmit(e){
      e.preventDefault();
      const f=e.target;

      if(!f.name.value.trim()){ alert("è«‹è¼¸å…¥å§“å"); return; }
      if(!/^\d{11}$/.test(f.phone.value.trim())){ alert("è«‹è¼¸å…¥ 11 ä½æ•¸å­—çš„è¯çµ¡é›»è©±"); return; }
      if(!f.email.checkValidity()){ alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­ä¿¡ç®±"); return; }
      if(!$("event").value.trim()){ alert("è«‹è¼¸å…¥æ´»å‹•åç¨±"); return; }

      const sel=getSelectedDates(); if(!sel){ alert("è«‹é¸æ“‡å®Œæ•´çš„ç§Ÿå€Ÿæ—¥æœŸå€é–“ï¼"); return; }

      const place=$("pickup").value;
      if(!place){ alert("è«‹é¸æ“‡å–æ©Ÿåœ°é»"); return; }

      const pickupTime = $("pickupTime").value || OTHER_PLACE_SLOT;
      const returnTimeStr = $("returnTime").value || pickupTime;

      if(!$("model").value){ alert("è«‹é¸æ“‡ç§Ÿå€Ÿè¨­å‚™ï¼"); return; }
      if(!$("currency").value){ alert("è«‹é¸æ“‡ä»˜æ¬¾å¹£åˆ¥ï¼"); return; }
      if(!$("contactType").value){ alert("è«‹é¸æ“‡è¯çµ¡æ–¹å¼ï¼ˆIG/LINEï¼‰"); return; }
      if(!$("contactId").value.trim()){ alert("è«‹è¼¸å…¥è¯çµ¡å¸³è™Ÿ"); return; }
      if(!$("agree").checked){ alert("è«‹å…ˆé–‹å•Ÿä¸¦é–±è®€ç§Ÿå€ŸæŒ‡å—è‡³åº•éƒ¨ï¼Œæ‰èƒ½å‹¾é¸åŒæ„ï¼"); return; }

      const [s,eDate]=sel;

      // æª¢æŸ¥å·²é ç´„æ—¥
      let cur=new Date(s.getFullYear(),s.getMonth(),s.getDate());
      const last=new Date(eDate.getFullYear(),eDate.getMonth(),eDate.getDate());
      while(cur<=last){ if(disabledSet.has(toYMDLocal(cur))){ alert(`âŒ é‡è¤‡æ—¥æœŸï¼š${toYMDLocal(cur)} å·²è¢«é ç´„ï¼Œè«‹æ”¹é¸å…¶ä»–æ—¥æœŸã€‚`); return;} cur.setDate(cur.getDate()+1); }

      const {days,startDT,endDT}=daysBy24h(s,eDate,pickupTime);
      const currency=$("currency").value;
      const per=unitPrice(currency,days);
      const rentTotal=per*days;
      const deposit=depositOf(currency);
      const grand=rentTotal+deposit;
      const over=calcOverage(currency,endDT,returnTimeStr);

      const payload={
        name:f.name.value.trim(),
        phone:f.phone.value.trim(),
        email:f.email.value.trim(),
        startDate:toYMDLocal(s),
        endDate:toYMDLocal(eDate),
        pickupTime,
        returnTime:returnTimeStr,
        startISO:startDT.toISOString(),
        plannedEndISO:endDT.toISOString(),
        estimatedOverageHours:over.hours,
        estimatedOverageFee:over.fee,
        estimatedOverageRule:over.rule,
        days:`${days}å¤©ï¼ˆ24h/æ—¥åˆ¶ï¼‰`,
        model:f.model.value,
        charger:f.charger?.checked?"éœ€è¦":"ä¸éœ€è¦",
        usba:f.usba?.checked?"éœ€è¦":"ä¸éœ€è¦",
        contactType:$("contactType").value,
        contactId:$("contactId").value.trim(),
        event:$("event").value.trim(),
        pickup:place,
        pickupTimeIsProvisional: place.includes('å…¶ä»–') ? 'yes' : 'no',
        note:$("note").value.trim(),
        currency,
        dailyPrice:per,
        rentTotal,
        deposit,
        grandTotal:grand,
        agree:"yes",
        timestamp:new Date().toISOString(),
      };

      const btn=$("submitBtn"); const txt=btn.textContent;
      btn.disabled=true; btn.textContent="é€å‡ºä¸­â€¦";
      try{
        const res=await fetch(API_BASE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
        const text=await res.text(); let result; try{ result=JSON.parse(text);}catch{ alert("âŒ å¾Œç«¯ä¸æ˜¯ JSON å›æ‡‰ï¼š\n\n"+text.slice(0,500)); return;}
        if(result && (result.success===true || result.status==="success")){ window.location.href="thanks.html"; }
        else{ alert("âŒ é ç´„å¤±æ•—ï¼š"+((result && (result.message||result.error))||"æœªçŸ¥éŒ¯èª¤")); }
      }catch(err){ alert("âŒ é€å‡ºå¤±æ•—ï¼š"+err.message); }
      finally{ btn.disabled=false; btn.textContent=txt; }
    }

    // æŒ‡å—å½ˆçª—
    function openGuide(){ $("guideModal").style.display="flex"; const sc=$("guideScroll"); sc.scrollTop=0; $("agree").checked=false; $("agree").disabled=true; }
    function closeGuide(){ $("guideModal").style.display="none"; }
    function onGuideScroll(){ const sc=$("guideScroll"); if(sc.scrollTop+sc.clientHeight >= sc.scrollHeight-8){ $("agree").disabled=false; } }

    init();
  </script>
</body>
</html>
